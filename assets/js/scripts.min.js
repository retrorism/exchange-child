function handleScroll(){var e=pageYOffset;jQuery(window).scroll(function(){var a=jQuery(this).scrollTop();e=a,pageYOffset<100?jQuery(".breadcrumbs-bar").removeClass("scrolled"):jQuery(".breadcrumbs-bar").addClass("scrolled")})}function getArchiveMap(){if(void 0!=Exchange&&void 0!=Exchange.PluginExtensions&&void 0!=Exchange.PluginExtensions.LMP&&void 0!=Exchange.PluginExtensions.LMP.maps){for(var e in Exchange.PluginExtensions.LMP.maps)if(Exchange.PluginExtensions.LMP.maps.hasOwnProperty(e)){var a=Exchange.PluginExtensions.LMP.maps[e];a.hash=e.slice(4);break}return a?a:void 0}}function getUrlVars(){for(var e,a=[],t=window.location.href.slice(window.location.href.indexOf("?")+1).split("&"),o=0;o<t.length;o++)e=t[o].split("="),a.push(e[0]),a[e[0]]=e[1];return a}function getFocusTranslate(e,a){if(img_data=e.parentNode.dataset,!img_data)return!1;var t=a.clientHeight,o=e.offsetHeight,r=img_data.focus_h*t-o/2,n=(t-o)/t*100,s=r/t*100;return!(r<0||s<0)&&(s>n?n:s)}function doFocusTranslate(e){var a=e.parentNode;if(translate=getFocusTranslate(a,e),translate){var t=translate>0?-1*translate:translate,o="transform: translateY("+t+"%);";e.setAttribute("style",o)}}jQuery(document).foundation();var masonryOptions={percentPosition:!0,columnWidth:".masonry__grid-sizer",gutter:".masonry__gutter-sizer",itemSelector:".archive__grid__griditem"},masonryIsActive=!1;!function(e){e(document).ready(function(){if(void 0==a)var a=e(".archive__grid__masonry");"object"==typeof FWP?wp.hooks.addFilter("facetwp/template_html",function(a,t){return FWP.is_load_more?(FWP.is_load_more=!1,e(".facetwp-template").append(t.html),!0):a}):console.log("FWP is not defined yet"),e(".focus").each(function(){var a=e(this).find(".image--main");a.on("load",function(e){doFocusTranslate(e.target)})});for(var t=document.querySelectorAll(".floated"),o=0;o<t.length;o++){var r=t[o].nextElementSibling,n=t[o].offsetHeight,s=r.offsetHeight;n>s&&(r.style.height=n+"px")}if(e("a[data-open=story__modal--gallery]").on("click",function(a){a.preventDefault();var t=e(this).data("img_id"),o=e("#story__modal--gallery").find("#"+t);e(".orbit").foundation("changeSlide",!0,o)}),e("#token-form__submit").on("click",function(a){a.preventDefault(),e(this).prop("disabled",!0);var t=e(".token-form__collab-select option:selected"),o=e(".grid--form-options"),r=getUrlVars().pr;if(void 0!==t){var n={action:"exchange_token_form",update_id:t.val(),prid:t.data("programme-round"),token:r,security:e(".token-form__nonce").val()};e(".loader-pointer").remove(),e(".loader-wrapper").addClass("go"),o.html(""),e.ajax({url:exchange_ajax.ajax_url,method:"POST",data:n}).done(function(a){o.html(a),e(".loader-wrapper").removeClass("go"),e(this).removeProp("disabled")})}}),e(".translatedparagraph--has_translations").each(function(){var a=e(this).find(".translation-select");a.on("change",function(){function a(a){return function(t,o){e(this).removeClass("show"),e(this).hasClass(a)&&e(this).addClass("show")}}var t="paragraph--"+this.value,o=e(this).parent().parent(".translatedparagraph--has_translations");paragraphs=o.children(".translatedparagraph__paragraph"),paragraphs.each(a(t))})}),(e("body").hasClass("single")||e("body").hasClass("page-child"))&&e("#main").on("scrollme.zf.trigger",handleScroll),e("body").hasClass("archive")||e("body").hasClass("page-template-archive")){if(!e("body").hasClass("post-type-archive-story")){if(void 0==i)var i=getArchiveMap();i&&i.map.fitBounds(i.clusterLayer.getBounds())}void 0!==a&&(a.masonry(masonryOptions),masonryIsActive=!0)}e("#facet-tabs").on("change.zf.tabs",function(){if(void 0==e)var e=getArchiveMap();void 0!=e.map&&e.map.invalidateSize().fitBounds(e.clusterLayer.getBounds()),void 0!==a&&(a.masonry(masonryOptions),masonryIsActive=!0)}),e("#facet-switch").on("click",function(){"#main".foundation("toggle")}),e(".accordion p:empty, .orbit p:empty").remove(),e(".archive__grid .columns","relatedgrid .columns").last().addClass("end"),e('iframe[src*="youtube.com"], iframe[src*="vimeo.com"]').each(function(){e(this).innerWidth()/e(this).innerHeight()>1.5?e(this).wrap("<div class='widescreen flex-video'/>"):e(this).wrap("<div class='flex-video'/>")})}),e(document).on("click",".fwp-load-more",function(){e(".fwp-load-more").html("Loading..."),FWP.is_load_more=!0,FWP.paged=parseInt(FWP.settings.pager.page)+1,FWP.soft_refresh=!0,FWP.refresh()}),e(document).on("facetwp-loaded",function(){var a=e(".archive__grid__masonry");masonryIsActive&&a.masonry("destroy"),a.masonry(masonryOptions),masonryIsActive=!0;var t=getArchiveMap();if(void 0!=t){var o=window["leaflet_objects_"+t.hash];if(void 0!=o&&0!=o.map_polylines.length&&0!=FWP.settings.matches.length){if(o.map_polylines.length>0&&FWP.settings.matches.length>0){var r=o.map_polylines.filter(function(e){if(FWP.settings.matches.includes(e.id))return!0});if(r.length>0){var n={map_polylines:r};t.renderObjects(n)}}FWP.settings.pager.page<FWP.settings.pager.total_pages?!FWP.loaded&&1>e(".fwp-load-more").length?e(".facetwp-template").after('<button style="clear: both;" class="fwp-load-more">Load more</button>'):e(".fwp-load-more").html("Load more").show():e(".fwp-load-more").hide(),FWP.settings.pager.page>1&&e("html, body").animate({scrollTop:e(".archive__grid__masonry").offset().bottom},1e3)}}}),e(document).on("facetwp-refresh",function(){FWP.loaded||(FWP.paged=1)})}(jQuery);
//# sourceMappingURL=scripts.min.js.map
